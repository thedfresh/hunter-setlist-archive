generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EventType {
  id             Int      @id @default(autoincrement())
  name           String
  includeInStats Boolean  @default(true) @map("include_in_stats")
  createdAt      DateTime @default(now()) @map("created_at")
  events         Event[]

  @@map("event_types")
}

model ContentType {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  events    Event[]

  @@map("content_types")
}

model Band {
  id            Int            @id @default(autoincrement())
  name          String
  createdAt     DateTime       @default(now()) @map("created_at")
  publicNotes   String?        @map("public_notes")
  privateNotes  String?        @map("private_notes")
  slug          String?        @unique
  displayName   String?        @map("display_name")
  isHunterBand  Boolean        @default(true) @map("is_hunter_band")
  bandMusicians BandMusician[]
  events        Event[]        @relation("PrimaryBand")
  sets          Set[]

  @@map("bands")
}

model BandMusician {
  id           Int       @id @default(autoincrement())
  bandId       Int       @map("band_id")
  musicianId   Int       @map("musician_id")
  joinedDate   DateTime? @map("joined_date")
  leftDate     DateTime? @map("left_date")
  createdAt    DateTime  @default(now()) @map("created_at")
  publicNotes  String?   @map("public_notes")
  privateNotes String?   @map("private_notes")
  band         Band      @relation(fields: [bandId], references: [id])
  musician     Musician  @relation(fields: [musicianId], references: [id])
  instruments  BandMusicianInstrument[]
  
  @@unique([bandId, musicianId])
  @@map("band_musicians")
}

model Venue {
  id            Int      @id @default(autoincrement())
  name          String
  city          String?
  stateProvince String?  @map("state_province")
  country       String?
  isUncertain   Boolean  @default(false) @map("is_uncertain")
  createdAt     DateTime @default(now()) @map("created_at")
  publicNotes   String?  @map("public_notes")
  context       String?
  privateNotes  String?  @map("private_notes")
  slug          String?  @unique
  events        Event[]
  links         Link[]

  @@map("venues")
}

model Musician {
  id                   Int                         @id @default(autoincrement())
  name                 String
  firstName            String?                     @map("first_name")
  lastName             String?                     @map("last_name")
  isUncertain          Boolean                     @default(false) @map("is_uncertain")
  createdAt            DateTime                    @default(now()) @map("created_at")
  privateNotes         String?                     @map("private_notes")
  publicNotes          String?                     @map("public_notes")
  slug                 String?                     @unique
  bandMusicians        BandMusician[]
  eventMusicians       EventMusician[]
  defaultInstruments   MusicianDefaultInstrument[]
  defaultInstrumentId  Int?        @map("default_instrument_id")
  defaultInstrument    Instrument? @relation("MusicianDefaultInstrument", fields: [defaultInstrumentId], references: [id])
  performanceMusicians PerformanceMusician[]
  performanceVocals    Performance[]               @relation("PerformanceLeadVocals")
  songDefaultVocals    Song[]                      @relation("SongLeadVocals")
  setMusicians         SetMusician[]
  performanceVocalists PerformanceVocalist[]
  songVocalists        SongVocalist[]

  @@map("musicians")
}

model Instrument {
  id                   Int                         @id @default(autoincrement())
  name                 String
  displayName          String                      @map("display_name")
  createdAt            DateTime                    @default(now()) @map("created_at")
  bandMusicianInstruments        BandMusicianInstrument[]
  eventMusicianInstruments       EventMusicianInstrument[]
  setMusicianInstruments         SetMusicianInstrument[]
  performanceMusicianInstruments PerformanceMusicianInstrument[]
  eventMusicians       EventMusician[]
  musicianDefaults     MusicianDefaultInstrument[]
  performanceMusicians PerformanceMusician[]
  setMusicians         SetMusician[]
  defaultForMusicians  Musician[] @relation("MusicianDefaultInstrument")

  @@map("instruments")
}

model Event {
  id                           Int                @id @default(autoincrement())
  year                         Int?
  month                        Int?
  day                          Int?
  displayDate                  String?            @map("display_date")
  dateUncertain                Boolean            @default(false) @map("date_uncertain")
  venueId                      Int?               @map("venue_id")
  venueUncertain               Boolean            @default(false) @map("venue_uncertain")
  eventTypeId                  Int?               @map("event_type_id")
  contentTypeId                Int?               @map("content_type_id")
  primaryBandId                Int?               @map("primary_band_id")
  hunterParticipationUncertain Boolean            @default(false) @map("hunter_participation_uncertain")
  billing                      String?
  publicNotes                  String?            @map("public_notes")
  verified                     Boolean            @default(false)
  createdAt                    DateTime           @default(now()) @map("created_at")
  updatedAt                    DateTime           @default(now()) @updatedAt @map("updated_at")
  isUncertain                  Boolean            @default(false) @map("is_uncertain")
  showTiming                   String?            @map("show_timing")
  rawData                      String?            @map("raw_data")
  privateNotes                 String?            @map("private_notes")
  isPublic                     Boolean            @default(true) @map("is_public")
  rawDataGdsets                String?            @map("raw_data_gdsets")
  etreeShowId                  String?            @map("etree_show_id")
  slug                         String?            @unique
  sortDate                     DateTime?          @map("sort_date")
  eventContributors            EventContributor[]
  eventMusicians               EventMusician[]
  contentType                  ContentType?       @relation(fields: [contentTypeId], references: [id])
  eventType                    EventType?         @relation(fields: [eventTypeId], references: [id])
  primaryBand                  Band?              @relation("PrimaryBand", fields: [primaryBandId], references: [id])
  venue                        Venue?             @relation(fields: [venueId], references: [id])
  links                        Link[]
  recordings                   Recording[]
  sets                         Set[]

  @@map("events")
}

model EventMusician {
  id           Int         @id @default(autoincrement())
  eventId      Int         @map("event_id")
  musicianId   Int         @map("musician_id")
  instrumentId Int?        @map("instrument_id")
  publicNotes  String?     @map("public_notes")
  createdAt    DateTime    @default(now()) @map("created_at")
  privateNotes String?     @map("private_notes")
  includesVocals Boolean   @default(false) @map("includes_vocals")
  instruments  EventMusicianInstrument[]
  event        Event       @relation(fields: [eventId], references: [id], onDelete: Cascade)
  instrument   Instrument? @relation(fields: [instrumentId], references: [id])
  musician     Musician    @relation(fields: [musicianId], references: [id])

  @@map("event_musicians")
}

model SetType {
  id             Int      @id @default(autoincrement())
  name           String
  displayName    String   @map("display_name")
  includeInStats Boolean  @default(true) @map("include_in_stats")
  createdAt      DateTime @default(now()) @map("created_at")
  sets           Set[]

  @@map("set_types")
}

model Set {
  id           Int           @id @default(autoincrement())
  eventId      Int           @map("event_id")
  setTypeId    Int           @map("set_type_id")
  position     Int
  publicNotes  String?       @map("public_notes")
  createdAt    DateTime      @default(now()) @map("created_at")
  isUncertain  Boolean       @default(false) @map("is_uncertain")
  privateNotes String?       @map("private_notes")
  bandId       Int?          @map("band_id")
  performances Performance[]
  setMusicians SetMusician[]
  band         Band?         @relation(fields: [bandId], references: [id])
  event        Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  setType      SetType       @relation(fields: [setTypeId], references: [id])

  @@map("sets")
}

model SetMusician {
  id           Int         @id @default(autoincrement())
  setId        Int         @map("set_id")
  musicianId   Int         @map("musician_id")
  instrumentId Int?        @map("instrument_id")
  publicNotes  String?     @map("public_notes")
  privateNotes String?     @map("private_notes")
  includesVocals Boolean   @default(false) @map("includes_vocals")
  createdAt    DateTime    @default(now()) @map("created_at")
  instruments  SetMusicianInstrument[]
  instrument   Instrument? @relation(fields: [instrumentId], references: [id])
  musician     Musician    @relation(fields: [musicianId], references: [id])
  set          Set         @relation(fields: [setId], references: [id], onDelete: Cascade)

  @@map("set_musicians")
}

model Album {
  id           Int         @id @default(autoincrement())
  title        String
  artist       String?
  releaseYear  Int?        @map("release_year")
  isOfficial   Boolean     @default(true) @map("is_official")
  publicNotes  String?     @map("public_notes")
  createdAt    DateTime    @default(now()) @map("created_at")
  privateNotes String?     @map("private_notes")
  slug         String?     @unique
  songAlbums   SongAlbum[]

  @@map("albums")
}

model Tag {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  songTags    SongTag[]

  @@map("tags")
}

model Song {
  id             Int           @id @default(autoincrement())
  title          String
  originalArtist String?       @map("original_artist")
  arrangement    String?       @map("arrangement")
  parentSongId   Int?          @map("parent_song_id")
  songBy         String?       @map("song_by")
  lyricsBy       String?       @map("lyrics_by")
  musicBy        String?       @map("music_by")
  leadVocalsId   Int?          @map("lead_vocals_id")
  isUncertain    Boolean       @default(false) @map("is_uncertain")
  publicNotes    String?       @map("public_notes")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @default(now()) @updatedAt @map("updated_at")
  inBoxOfRain    Boolean       @default(false) @map("in_box_of_rain")
  alternateTitle String?       @map("alternate_title")
  privateNotes   String?       @map("private_notes")
  slug           String?       @unique
  isInstrumental Boolean       @default(false) @map("is_instrumental")
  vocalists      SongVocalist[]
  leadVocals     Musician?     @relation("SongLeadVocals", fields: [leadVocalsId], references: [id])
  parentSong     Song?         @relation("SongVariants", fields: [parentSongId], references: [id])
  variants       Song[]        @relation("SongVariants")
  links          Link[]
  performances   Performance[]
  songAlbums     SongAlbum[]
  songTags       SongTag[]

  @@map("songs")
}

model SongAlbum {
  id          Int      @id @default(autoincrement())
  songId      Int      @map("song_id")
  albumId     Int      @map("album_id")
  trackNumber Int?     @map("track_number")
  createdAt   DateTime @default(now()) @map("created_at")
  album       Album    @relation(fields: [albumId], references: [id])
  song        Song     @relation(fields: [songId], references: [id], onDelete: Cascade)

  @@map("song_albums")
}

model SongTag {
  id        Int      @id @default(autoincrement())
  songId    Int      @map("song_id")
  tagId     Int      @map("tag_id")
  createdAt DateTime @default(now()) @map("created_at")
  song      Song     @relation(fields: [songId], references: [id], onDelete: Cascade)
  tag       Tag      @relation(fields: [tagId], references: [id])

  @@unique([songId, tagId])
  @@map("song_tags")
}

model Performance {
  id                   Int                   @id @default(autoincrement())
  setId                Int                   @map("set_id")
  songId               Int                   @map("song_id")
  performanceOrder     Int                   @map("performance_order")
  seguesInto           Boolean               @default(false) @map("segues_into")
  isTruncatedStart     Boolean               @default(false) @map("is_truncated_start")
  isTruncatedEnd       Boolean               @default(false) @map("is_truncated_end")
  hasCuts              Boolean               @default(false) @map("has_cuts")
  isPartial            Boolean               @default(false) @map("is_partial")
  publicNotes          String?               @map("public_notes")
  publicNotesExpanded  String?               @map("public_notes_expanded")
  createdAt            DateTime              @default(now()) @map("created_at")
  isUncertain          Boolean               @default(false) @map("is_uncertain")
  leadVocalsId         Int?                  @map("lead_vocals_id")
  isLyricalFragment    Boolean               @default(false) @map("is_lyrical_fragment")
  isMedley             Boolean               @default(false) @map("is_medley")
  isMusicalFragment    Boolean               @default(false) @map("is_musical_fragment")
  isSoloHunter         Boolean               @default(false) @map("is_solo_hunter")
  privateNotes         String?               @map("private_notes")
  isAborted            Boolean               @default(false) @map("is_aborted")
  lyricalVariation     String?               @map("lyrical_variation")
  isInstrumental       Boolean               @default(false) @map("is_instrumental")
  vocalists            PerformanceVocalist[]
  leadVocals           Musician?             @relation("PerformanceLeadVocals", fields: [leadVocalsId], references: [id])
  set                  Set                   @relation(fields: [setId], references: [id], onDelete: Cascade)
  song                 Song                  @relation(fields: [songId], references: [id])
  performanceMusicians PerformanceMusician[]
  showBanter           ShowBanter[]

  @@map("performances")
}

model PerformanceMusician {
  id            Int         @id @default(autoincrement())
  performanceId Int         @map("performance_id")
  musicianId    Int         @map("musician_id")
  instrumentId  Int?        @map("instrument_id")
  publicNotes   String?     @map("public_notes")
  createdAt     DateTime    @default(now()) @map("created_at")
  privateNotes  String?     @map("private_notes")
  includesVocals  Boolean  @default(false) @map("includes_vocals")
  instruments   PerformanceMusicianInstrument[]
  instrument    Instrument? @relation(fields: [instrumentId], references: [id])
  musician      Musician    @relation(fields: [musicianId], references: [id])
  performance   Performance @relation(fields: [performanceId], references: [id], onDelete: Cascade)

  @@map("performance_musicians")
}

model Contributor {
  id                Int                @id @default(autoincrement())
  name              String
  createdAt         DateTime           @default(now()) @map("created_at")
  email             String?
  publicNotes       String?            @map("public_notes")
  privateNotes      String?            @map("private_notes")
  slug              String?            @unique
  eventContributors EventContributor[]
  recordings        Recording[]

  @@map("contributors")
}

model Recording {
  id              Int            @id @default(autoincrement())
  eventId         Int            @map("event_id")
  recordingTypeId Int?           @map("recording_type_id")
  description     String?
  url             String?
  shnId           String?        @map("shn_id")
  taper           String?
  contributorId   Int?           @map("contributor_id")
  lengthMinutes   Int?           @map("length_minutes")
  publicNotes     String?        @map("public_notes")
  createdAt       DateTime       @default(now()) @map("created_at")
  privateNotes    String?        @map("private_notes")
  lmaIdentifier   String?        @map("lma_identifier")
  losslessLegsId  String?        @map("lossless_legs_id")
  youtubeVideoId  String?        @map("youtube_video_id")
  featured        Boolean        @default(false)
  featuredText    String?        @map("featured_text")
  links           Link[]
  contributor     Contributor?   @relation(fields: [contributorId], references: [id])
  event           Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  recordingType   RecordingType? @relation(fields: [recordingTypeId], references: [id])

  @@map("recordings")
}

model RecordingType {
  id          Int         @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime    @default(now()) @map("created_at")
  recordings  Recording[]

  @@map("recording_types")
}

model EventContributor {
  id            Int          @id @default(autoincrement())
  eventId       Int          @map("event_id")
  contributorId Int?         @map("contributor_id")
  description   String?
  publicNotes   String?      @map("public_notes")
  createdAt     DateTime     @default(now()) @map("created_at")
  privateNotes  String?      @map("private_notes")
  contributor   Contributor? @relation(fields: [contributorId], references: [id])
  event         Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_contributors")
}

model ShowBanter {
  id            Int         @id @default(autoincrement())
  banterText    String      @map("banter_text")
  createdAt     DateTime    @default(now()) @map("created_at")
  isBeforeSong  Boolean     @default(false) @map("is_before_song")
  isVerbatim    Boolean     @default(false) @map("is_verbatim")
  performanceId Int         @map("performance_id")
  privateNotes  String?     @map("private_notes")
  publicNotes   String?     @map("public_notes")
  performance   Performance @relation(fields: [performanceId], references: [id])

  @@map("show_banter")
}

model MusicianDefaultInstrument {
  id           Int        @id @default(autoincrement())
  musicianId   Int        @map("musician_id")
  instrumentId Int        @map("instrument_id")
  createdAt    DateTime   @default(now()) @map("created_at")
  instrument   Instrument @relation(fields: [instrumentId], references: [id])
  musician     Musician   @relation(fields: [musicianId], references: [id], onDelete: Cascade)

  @@unique([musicianId, instrumentId])
  @@map("musician_default_instruments")
}

model Link {
  id          Int        @id @default(autoincrement())
  url         String
  title       String?
  description String?
  isActive    Boolean    @default(true)
  dateFetched DateTime?  @map("date_fetched")
  isPublic    Boolean    @default(true) @map("is_public")
  createdAt   DateTime   @default(now()) @map("created_at")
  eventId     Int?       @map("event_id")
  songId      Int?       @map("song_id")
  venueId     Int?       @map("venue_id")
  recordingId Int?       @map("recording_id")
  linkTypeId  Int?       @map("link_type_id")
  event       Event?     @relation(fields: [eventId], references: [id])
  linkType    LinkType?  @relation(fields: [linkTypeId], references: [id])
  recording   Recording? @relation(fields: [recordingId], references: [id])
  song        Song?      @relation(fields: [songId], references: [id])
  venue       Venue?     @relation(fields: [venueId], references: [id])

  @@map("links")
}

model LinkType {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  links       Link[]

  @@map("link_types")
}

model RssEntry {
  id          Int      @id @default(autoincrement())
  title       String
  description String   @db.Text
  link        String?
  pubDate     DateTime @default(now()) @map("pub_date")
  isPublished Boolean  @default(false) @map("is_published")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("rss_entries")
}

model DataMigration {
  id         Int      @id @default(autoincrement())
  filename   String   @unique @db.VarChar(255)
  appliedAt  DateTime @default(now()) @map("applied_at") @db.Timestamp(6)
  
  @@map("data_migrations")
}

// ============================================
// BAND MUSICIAN INSTRUMENTS
// ============================================

model BandMusicianInstrument {
  id             Int @id @default(autoincrement())
  bandMusicianId Int @map("band_musician_id")
  instrumentId   Int @map("instrument_id")
  createdAt      DateTime @default(now()) @map("created_at")
  
  bandMusician BandMusician @relation(fields: [bandMusicianId], references: [id], onDelete: Cascade)
  instrument   Instrument @relation(fields: [instrumentId], references: [id])
  
  @@unique([bandMusicianId, instrumentId])
  @@map("band_musician_instruments")
}

// ============================================
// EVENT MUSICIAN INSTRUMENTS
// ============================================

model EventMusicianInstrument {
  id              Int @id @default(autoincrement())
  eventMusicianId Int @map("event_musician_id")
  instrumentId    Int @map("instrument_id")
  createdAt       DateTime @default(now()) @map("created_at")
  
  eventMusician EventMusician @relation(fields: [eventMusicianId], references: [id], onDelete: Cascade)
  instrument    Instrument @relation(fields: [instrumentId], references: [id])
  
  @@unique([eventMusicianId, instrumentId])
  @@map("event_musician_instruments")
}

// ============================================
// SET MUSICIAN INSTRUMENTS
// ============================================

model SetMusicianInstrument {
  id            Int @id @default(autoincrement())
  setMusicianId Int @map("set_musician_id")
  instrumentId  Int @map("instrument_id")
  createdAt     DateTime @default(now()) @map("created_at")
  
  setMusician SetMusician @relation(fields: [setMusicianId], references: [id], onDelete: Cascade)
  instrument  Instrument @relation(fields: [instrumentId], references: [id])
  
  @@unique([setMusicianId, instrumentId])
  @@map("set_musician_instruments")
}

// ============================================
// PERFORMANCE MUSICIAN INSTRUMENTS
// ============================================

model PerformanceMusicianInstrument {
  id                    Int @id @default(autoincrement())
  performanceMusicianId Int @map("performance_musician_id")
  instrumentId          Int @map("instrument_id")
  createdAt             DateTime @default(now()) @map("created_at")
  
  performanceMusician PerformanceMusician @relation(fields: [performanceMusicianId], references: [id], onDelete: Cascade)
  instrument          Instrument @relation(fields: [instrumentId], references: [id])
  
  @@unique([performanceMusicianId, instrumentId])
  @@map("performance_musician_instruments")
}

// ============================================
// PERFORMANCE VOCALISTS
// ============================================

model PerformanceVocalist {
  id            Int @id @default(autoincrement())
  performanceId Int @map("performance_id")
  musicianId    Int? @map("musician_id")
  vocalRole     String? @map("vocal_role")
  createdAt     DateTime @default(now()) @map("created_at")
  
  performance Performance @relation(fields: [performanceId], references: [id], onDelete: Cascade)
  musician    Musician? @relation(fields: [musicianId], references: [id])
  
  @@unique([performanceId, musicianId])
  @@map("performance_vocalists")
}

// ============================================
// SONG VOCALISTS
// ============================================

model SongVocalist {
  id         Int @id @default(autoincrement())
  songId     Int @map("song_id")
  musicianId Int? @map("musician_id")
  vocalRole  String? @map("vocal_role")
  createdAt  DateTime @default(now()) @map("created_at")
  
  song     Song @relation(fields: [songId], references: [id], onDelete: Cascade)
  musician Musician? @relation(fields: [musicianId], references: [id])
  
  @@unique([songId, musicianId])
  @@map("song_vocalists")
}